:root{
  --motrac-red:#E2001A;
  --motrac-red-600:#c00015;
  --motrac-red-700:#9b0011;
  --ink:#0b0d0f;
  --ink-2:#202428;
  --ink-3:#30363d;
  --bg:#f7f7f8;
  --card:#ffffff;
  --card-glass:rgba(255,255,255,.92);
  --muted:#6b7280;
  --border-subtle:#ececf1;
  --border-strong:#e5e7eb;
  --surface-soft:#fbfbfc;
  --ring: rgba(226,0,26,.35);
  --ok:#15803d;
  --warn:#b45309;
  --err:#b91c1c;
  --shadow:0 10px 20px rgba(0,0,0,.06),0 2px 6px rgba(0,0,0,.05);
  --shadow-strong:0 26px 46px rgba(13,15,19,.1),0 6px 16px rgba(13,15,19,.08);
  --radius:14px;
  --app-height:100dvh;
  --app-width:100vw;
  --rood:#A00020;
  --goud:#C8A76A;
  --hemel:#03040a;
  --licht:#F4F5F7;
  --glas:rgba(25,28,40,.72);
  --glas2:rgba(255,255,255,.1);
  --rand:rgba(255,255,255,.22);
  --blur:10px;
  --eio:cubic-bezier(.22,.61,.36,1);
}
*{box-sizing:border-box}
html,body{height:100%}
html{
  scrollbar-gutter:stable both-edges;
  background:var(--bg);
}
body{ 
  margin:0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  color:var(--ink);
  background:var(--bg);
  position:relative;
  transition:color .3s ease, background-color .3s ease;
}

body.splash{
  min-height:100vh;
  min-height:100dvh;
  min-height:100svh;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

.splash-content{
  position:relative;
  z-index:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:2.4rem;
}

.splash-logo{
  width:min(58vw, 320px);
  max-width:100%;
  height:auto;
  filter:drop-shadow(0 24px 48px rgba(3,4,10,.45));
}

body.background-match{
  --ink:var(--licht);
  --ink-2:#d9deeb;
  --ink-3:#9aa5bb;
  --bg:var(--hemel);
  --card:var(--glas);
  --card-glass:rgba(25,28,40,.78);
  --muted:rgba(168,178,200,.82);
  --border-subtle:rgba(255,255,255,.08);
  --border-strong:rgba(255,255,255,.18);
  --surface-soft:rgba(25,28,40,.72);
  --shadow:0 32px 70px rgba(3,4,10,.55),0 10px 24px rgba(3,4,10,.4);
  --shadow-strong:0 42px 80px rgba(3,4,10,.6),0 16px 30px rgba(3,4,10,.5);
  color:var(--ink);
  background:var(--hemel);
}

body.background-match.light{
  background:linear-gradient(180deg,#141a2d,#0f1220 60%);
}

body.background-match header{
  background:linear-gradient(180deg, rgba(16,20,32,.9), rgba(16,20,32,.68));
  border-bottom:1px solid var(--rand);
  box-shadow:0 28px 56px rgba(3,4,10,.55);
  backdrop-filter:saturate(1.1) blur(var(--blur));
}

body.background-match .card{
  backdrop-filter:saturate(1.2) blur(var(--blur));
}

body.background-match .logo{
  background:rgba(25,28,40,.78);
  border-color:var(--border-strong);
  box-shadow:inset 0 -3px 10px rgba(0,0,0,.35),0 0 20px rgba(0,231,255,.15);
}

body.background-match .btn.secondary{
  color:var(--ink);
}

body.background-match .background-scene{
  position:fixed;
  top:calc(env(safe-area-inset-top, 0px) * -1);
  left:calc(env(safe-area-inset-left, 0px) * -1);
  width:calc(var(--viewport-width, 100vw) + env(safe-area-inset-left, 0px) + env(safe-area-inset-right, 0px));
  height:calc(var(--viewport-height, 100vh) + env(safe-area-inset-top, 0px) + env(safe-area-inset-bottom, 0px));
  min-height:100vh;
  min-height:100dvh;
  min-height:100svh;
  pointer-events:none;
  z-index:-3;
  overflow:hidden;
}

body.background-match .background-scene canvas{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  display:block;
}

body.background-match #neurons{
  z-index:-3;
  opacity:1;
}

body.background-match #protons{
  z-index:-2;
  opacity:1;
}

body.background-match .background-scene .nevel{
  position:absolute;
  inset:-10%;
  z-index:-2;
  mix-blend-mode:screen;
  background:
    radial-gradient(900px 600px at 20% 20%, rgba(200,167,106,.22), transparent 60%),
    radial-gradient(700px 600px at 80% 70%, rgba(255,255,255,.14), transparent 60%);
  opacity:.35;
}

body.background-match .background-scene .raster{
  position:absolute;
  inset:0;
  z-index:-1;
  opacity:.1;
  background-size:70px 70px;
  background-image:
    linear-gradient(var(--glas2) 1px, transparent 1px),
    linear-gradient(90deg, var(--glas2) 1px, transparent 1px);
}

body.background-match .background-scene .pulse{
  position:absolute;
  inset:0;
  margin:auto;
  width:min(64vw,720px);
  aspect-ratio:1;
  border-radius:50%;
  filter:blur(34px);
  pointer-events:none;
  background:radial-gradient(circle, rgba(0,231,255,.22) 0%, transparent 70%);
  animation:pulse 3.2s var(--eio) infinite;
  z-index:-1;
}

@keyframes pulse{
  0%,100%{transform:scale(.96);opacity:.7}
  50%{transform:scale(1.06);opacity:1}
}

@media (prefers-reduced-motion: reduce){
  body.background-match .background-scene .pulse{
    animation:none;
  }
}
body[data-theme="dark"]{
  --ink:#f1f4f9;
  --ink-2:#d7dce5;
  --ink-3:#99a2b3;
  --bg:#0f1115;
  --card:#161b22;
  --card-glass:rgba(26,33,45,.85);
  --muted:#9aa3b5;
  --border-subtle:#232a34;
  --border-strong:#2f3642;
  --surface-soft:#1c2330;
  --shadow:0 20px 40px rgba(0,0,0,.58),0 6px 18px rgba(0,0,0,.45);
  --shadow-strong:0 40px 60px rgba(0,0,0,.6),0 14px 26px rgba(0,0,0,.45);
}

body.chat-page:not(.background-match){
  background:
    radial-gradient(1200px circle at -10% -10%, rgba(226,0,26,.12), transparent 55%),
    radial-gradient(900px circle at 110% 10%, rgba(231,76,60,.12), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.94), rgba(247,247,248,.94));
}
body.chat-page:not(.background-match)::before{
  content:'';
  position:fixed;
  inset:0;
  background-image:radial-gradient(1px 1px at 20px 20px, rgba(226,0,26,.12) 0, rgba(226,0,26,.12) 35%, transparent 35%), radial-gradient(1px 1px at 60px 60px, rgba(14,116,144,.12) 0, rgba(14,116,144,.12) 40%, transparent 40%);
  background-size:120px 120px;
  opacity:.3;
  pointer-events:none;
  z-index:-1;
}
body[data-theme="dark"].chat-page:not(.background-match){
  background:
    radial-gradient(1000px circle at -10% -10%, rgba(226,0,26,.25), transparent 55%),
    radial-gradient(900px circle at 110% 10%, rgba(126,34,206,.18), transparent 60%),
    linear-gradient(180deg, #0f1115, #12151b);
}
body[data-theme="dark"].chat-page:not(.background-match)::before{
  opacity:.4;
  background-image:radial-gradient(1px 1px at 18px 18px, rgba(226,0,26,.18) 0, rgba(226,0,26,.18) 35%, transparent 35%), radial-gradient(1px 1px at 48px 52px, rgba(59,130,246,.2) 0, rgba(59,130,246,.2) 42%, transparent 42%);
  z-index:-1;
}
header{
  position:sticky;
  top:0;
  z-index:10;
  backdrop-filter:saturate(1.1) blur(6px);
  background:linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.72));
  border-bottom:1px solid rgba(12,15,20,.06);
  box-shadow:0 16px 30px rgba(15,17,22,.08);
}
body[data-theme="dark"] header{
  background:linear-gradient(180deg, rgba(17,20,26,.9), rgba(17,20,26,.75));
  border-bottom:1px solid rgba(14,17,22,.55);
  box-shadow:0 20px 40px rgba(0,0,0,.45);
}
body.background-match[data-theme="dark"] header{
  background:linear-gradient(180deg, rgba(16,20,32,.9), rgba(16,20,32,.68));
  border-bottom:1px solid var(--rand);
  box-shadow:0 28px 56px rgba(3,4,10,.55);
}
.bar{
  max-width:1200px;
  margin:0 auto;
  padding:18px 24px;
  display:flex;
  align-items:center;
  gap:14px;
  flex-wrap:wrap;
}
.bar > *{min-width:0}
.logo{
  width:48px;
  height:48px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:6px;
  background:var(--card);
  border:1px solid var(--border-subtle);
  box-shadow:var(--shadow);
  overflow:hidden;
  flex-shrink:0;
}

.logo img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
}
.headings{display:flex;flex-direction:column;gap:4px;min-width:0;flex:1 1 240px}
.title{font-size:18px;font-weight:750;letter-spacing:.2px;line-height:1.2}
.sub{font-size:13px;color:var(--muted)}

.wrap{
  max-width:1240px;
  margin:32px auto 48px;
  padding:0 24px 72px;
  display:grid;
  grid-template-columns:minmax(260px,320px) minmax(0,1fr);
  gap:24px;
  align-items:start;
}
@media (max-width: 980px){
  .wrap{grid-template-columns:1fr;padding:0 20px 56px;margin:24px auto 48px}
  .side{order:2}
}

.card{
  background:var(--card);
  border:1px solid var(--border-subtle);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
body.chat-page .card{
  background:var(--card-glass);
  border:1px solid rgba(12,18,28,.1);
  backdrop-filter:saturate(1.2) blur(18px);
  box-shadow:var(--shadow-strong);
}
body[data-theme="dark"].chat-page .card{
  border-color:rgba(11,16,24,.55);
}

.side{display:flex;flex-direction:column;gap:14px}
body.chat-page .side{position:sticky;top:120px;align-self:start}
@media (max-width: 980px){
  body.chat-page .side{position:static}
}

.panel{padding:14px}
body.chat-page .panel{padding:20px 22px}
.panel h3{margin:0 0 10px;font-size:14px;text-transform:uppercase;letter-spacing:.08em;color:var(--ink)}
.hint{font-size:12px;color:var(--muted)}

.upload{
  border:1px dashed var(--border-subtle);
  border-radius:12px;
  padding:14px;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center;
  text-align:center;
  cursor:pointer;
  background:var(--surface-soft);
}
.upload:hover{border-color:var(--motrac-red)}
.upload input{display:none}

.doc-list{
  display:flex;
  flex-direction:column;
  gap:8px;
  max-height:220px;
  overflow:auto;
  padding-right:4px;
}
.doc{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px;
  border:1px solid var(--border-subtle);
  border-radius:12px;
}
.doc .dot{width:9px;height:9px;border-radius:99px;background:var(--motrac-red)}
.doc .meta{flex:1}
.doc .name{font-size:13px;font-weight:600}
.doc .small{font-size:12px;color:var(--muted)}
.doc button{
  border:none;
  background:transparent;
  color:var(--motrac-red);
  font-weight:600;
  cursor:pointer;
}

.precheck{display:flex;flex-direction:column;gap:14px}
.precheck .field{display:flex;flex-direction:column;gap:6px}
.precheck label{font-size:13px;font-weight:600;color:var(--ink)}
.precheck .field.invalid label{color:var(--err)}
.precheck .error{display:none;color:var(--err)}
.precheck .field.invalid .error{display:block}
.precheck .field.invalid .input{border-color:var(--err)}
.precheck .field.invalid .input:focus{box-shadow:0 0 0 3px rgba(185,28,28,.35)}
.precheck-status{margin:0;padding:10px;border-radius:10px;background:var(--surface-soft);border:1px solid var(--border-subtle)}
.precheck-status.ok{border-color:rgba(21,128,61,.45);background:rgba(21,128,61,.08)}

.prechat-page{
  min-height:var(--app-height, 100dvh);
  display:flex;
  flex-direction:column;
  background:linear-gradient(150deg, rgba(226,0,26,.08), rgba(226,0,26,.02));
}
.prechat-top{
  display:flex;
  width:100%;
  max-width:560px;
  padding:24px 18px 16px;
  margin:0 auto;
  align-items:flex-start;
}
.prechat-top .logo{width:60px;height:60px;padding:8px}
.prechat-branding{display:flex;flex-direction:column;gap:6px}
.prechat-suptitle{font-size:12px;text-transform:uppercase;letter-spacing:.18em;color:var(--muted)}
.prechat-title{margin:0;font-size:26px;letter-spacing:.03em}
.prechat-sub{margin:0;font-size:14px;color:var(--muted);line-height:1.5}
.prechat-container{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:12px 18px 24px;
}
.prechat-card{
  width:100%;
  max-width:520px;
  display:flex;
  flex-direction:column;
  gap:18px;
}
.prechat-header{display:flex;gap:14px;align-items:center}
.prechat-header .logo{flex-shrink:0}
.prechat-titles{display:flex;flex-direction:column;gap:4px}
.prechat-titles h2{margin:0;font-size:20px;letter-spacing:.04em}
.prechat-actions{display:grid;grid-template-columns:repeat(2, minmax(0,1fr));gap:10px}
.prechat-actions .btn{min-height:48px}
.prechat-benefits{margin:0;padding:0;list-style:none;display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}
.prechat-benefits li{display:flex;align-items:center;gap:8px}
.prechat-benefits li::before{content:'âœ“';color:var(--motrac-red);font-weight:700}
.prechat-footnote{margin:0;color:var(--muted);line-height:1.5}
.history-page .wrap{display:block}
.history-layout{
  max-width:1100px;
  margin:24px auto 32px;
  padding:0 18px;
  display:flex;
  flex-direction:column;
  gap:18px;
}
.history-controls{display:flex;flex-direction:column;gap:14px}
.history-controls h1{margin:0;font-size:24px;letter-spacing:.02em}
.history-search{display:flex;align-items:center;gap:12px}
.history-search .input{flex:1}
.history-columns{
  display:grid;
  gap:18px;
  grid-template-columns:repeat(auto-fit, minmax(320px, 1fr));
}
.history-section{display:flex;flex-direction:column;gap:14px}
.history-section-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.history-section-header h2{margin:0;font-size:18px}
.history-list{display:flex;flex-direction:column;gap:12px}
.history-empty{margin:0}
.history-item{display:flex;flex-direction:column;gap:12px}
.history-item-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.history-item-title{margin:0;font-size:18px;line-height:1.3;word-break:break-word}
.history-item-meta{white-space:nowrap}
.history-item-tags{display:flex;flex-wrap:wrap;gap:8px}
.history-item-preview{
  margin:0;
  font-size:13px;
  color:var(--ink-3);
  line-height:1.5;
  display:-webkit-box;
  -webkit-line-clamp:3;
  -webkit-box-orient:vertical;
  overflow:hidden;
}
.history-item-actions{display:flex;flex-wrap:wrap;gap:8px}
.history-item-actions .history-delete{
  color:var(--err);
  border-color:rgba(185,28,28,.35);
  background:rgba(185,28,28,.08);
}
.history-item-actions .history-delete:hover{
  background:rgba(185,28,28,.12);
}
body[data-theme="dark"] .history-item-actions .history-delete{
  border-color:rgba(185,28,28,.45);
  background:rgba(185,28,28,.18);
  color:var(--err);
}
@media (max-width: 720px){
  .bar{padding:16px 18px;gap:12px;align-items:flex-start}
  .bar .logo{order:1}
  .headings{order:2;width:100%}
  .right{order:3;width:100%;justify-content:flex-start;gap:8px}
  .right .btn{flex:1 1 140px;justify-content:center}
  .prechat-top{padding:20px 18px 14px}
  .prechat-branding{gap:8px}
  .prechat-title{font-size:24px}
  .prechat-container{padding:18px 18px 32px;align-items:flex-start}
  .prechat-card{gap:16px}
  .prechat-actions{grid-template-columns:1fr}
  .prechat-footer{padding:18px 16px 28px}
  .prechat-quick-actions{flex-direction:column;max-width:100%}
  .theme-toggle{right:16px;bottom:16px;padding:10px 14px;font-size:13px}
  .history-controls h1{font-size:22px}
  .history-item-title{font-size:17px}
  .history-section-header{flex-direction:column;align-items:flex-start}
  .history-item-header{flex-direction:column;align-items:flex-start}
  .history-item-meta{white-space:normal}
  .chat-toolbar{align-items:flex-start;flex-direction:column;gap:16px}
  .chat-toolbar-meta{gap:4px}
  body.chat-page .composer{flex-direction:column;align-items:stretch}
  body.chat-page .composer textarea{width:100%}
  body.chat-page .composer .btn{width:100%;justify-content:center;min-height:56px}
}
.prechat-footer{
  padding:18px;
  text-align:center;
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:center;
}
.prechat-quick-actions{
  margin-top:6px;
  display:flex;
  gap:12px;
  width:100%;
  max-width:420px;
}
.ios-button{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:14px 18px;
  border-radius:18px;
  border:1px solid rgba(12,18,28,.12);
  background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(244,244,248,.94));
  box-shadow:0 10px 24px rgba(15,17,22,.08), inset 0 1px 0 rgba(255,255,255,.65);
  font-size:14px;
  font-weight:600;
  color:var(--ink-2);
  text-decoration:none;
  transition:transform .16s ease, box-shadow .18s ease, background .18s ease;
}
.ios-button:focus-visible{
  outline:3px solid rgba(226,0,26,.2);
  outline-offset:3px;
}
.ios-button:hover{
  transform:translateY(-1px);
  box-shadow:0 14px 30px rgba(15,17,22,.12), inset 0 1px 0 rgba(255,255,255,.75);
}
.ios-button:active{
  transform:translateY(0);
  background:linear-gradient(180deg, rgba(236,236,240,.98), rgba(228,228,234,.94));
  box-shadow:0 4px 14px rgba(15,17,22,.12) inset;
}
body[data-theme="dark"] .ios-button{
  border-color:rgba(40,52,72,.65);
  background:linear-gradient(180deg, rgba(34,42,58,.95), rgba(24,29,42,.92));
  box-shadow:0 12px 28px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  color:var(--ink);
}
body[data-theme="dark"] .ios-button:hover{
  box-shadow:0 16px 34px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.12);
}
@media (max-width: 520px){
  .prechat-quick-actions{flex-direction:column;align-items:stretch}
}

.prechat-summary{display:flex;flex-direction:column;gap:14px}
.summary-list{margin:0;display:flex;flex-direction:column;gap:12px}
.summary-row{display:flex;justify-content:space-between;align-items:flex-start;gap:16px;padding:12px 14px;border-radius:14px;border:1px solid rgba(12,18,28,.08);background:rgba(255,255,255,.82);box-shadow:0 12px 26px rgba(15,17,22,.06)}
.summary-row dt{font-size:11px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted)}
.summary-row dd{margin:0;font-weight:650;color:var(--ink)}
.summary-row dd.empty{color:var(--muted);font-weight:500}
body[data-theme="dark"].chat-page .summary-row{background:rgba(23,30,42,.82);border-color:rgba(34,45,63,.65);box-shadow:0 18px 32px rgba(0,0,0,.45)}

.btn.full{width:100%;justify-content:center}

.chat{
  position:relative;
  display:flex;
  flex-direction:column;
  min-height:min(520px, var(--app-height, 100dvh));
  height:calc(var(--app-height, 100dvh) - 150px);
  overflow:hidden;
}
body.chat-page .chat::after{
  content:'';
  position:absolute;
  inset:auto 0 0;
  height:120px;
  background:linear-gradient(180deg, rgba(255,255,255,0), rgba(255,255,255,.72));
  pointer-events:none;
  z-index:0;
}
body[data-theme="dark"].chat-page .chat::after{
  background:linear-gradient(180deg, rgba(15,17,22,0), rgba(15,17,22,.92));
}
.chat-toolbar{
  position:relative;
  z-index:1;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding:18px 22px 12px;
  border-bottom:1px solid rgba(12,18,28,.08);
}
body[data-theme="dark"].chat-page .chat-toolbar{border-bottom:1px solid rgba(17,22,33,.65)}
.chat-toolbar-meta{display:flex;flex-direction:column;gap:6px}
.chat-toolbar-title{margin:0;font-size:18px;letter-spacing:.03em;color:var(--ink)}
.chat-toolbar-sub{margin:0;font-size:13px;color:var(--muted);max-width:420px;line-height:1.5}
.messages{
  position:relative;
  z-index:1;
  flex:1;
  overflow:auto;
  padding:22px;
  display:flex;
  flex-direction:column;
  gap:18px;
  scroll-padding:24px;
}
body.chat-page .messages{
  background:linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.88));
}
body[data-theme="dark"].chat-page .messages{
  background:linear-gradient(180deg, rgba(21,26,34,.88), rgba(13,17,24,.94));
}
.bubble{
  --bubble-bg:rgba(255,255,255,.96);
  --bubble-border:rgba(12,18,28,.1);
  --bubble-shadow:0 20px 36px rgba(15,17,22,.08);
  max-width:860px;
  padding:18px 20px;
  border-radius:18px;
  border:1px solid var(--bubble-border);
  background:var(--bubble-bg);
  box-shadow:var(--bubble-shadow);
  position:relative;
  backdrop-filter:saturate(1.05);
}
.bubble.assistant::before,
.bubble.user::before{
  content:'';
  position:absolute;
  inset:-12px;
  border-radius:inherit;
  opacity:.6;
  pointer-events:none;
  z-index:-1;
}
.bubble.assistant::before{background:radial-gradient(280px circle at 40px 20px, rgba(226,0,26,.1), transparent 70%);}
.bubble.user::before{background:radial-gradient(280px circle at calc(100% - 40px) 20px, rgba(59,130,246,.12), transparent 70%);}
.bubble.assistant{
  --bubble-bg:linear-gradient(170deg, rgba(255,255,255,.98), rgba(255,242,244,.94));
  --bubble-border:rgba(226,0,26,.18);
  --bubble-shadow:0 22px 42px rgba(226,0,26,.16);
}
.bubble.assistant.loading .content{
  display:flex;
  align-items:center;
  min-height:56px;
}
.bubble.assistant.loading .role{margin-bottom:10px}
.bubble.user{
  align-self:flex-end;
  --bubble-bg:linear-gradient(160deg, rgba(238,242,255,.95), rgba(224,231,255,.9));
  --bubble-border:rgba(59,130,246,.22);
  --bubble-shadow:0 22px 40px rgba(59,130,246,.18);
}
body[data-theme="dark"].chat-page .bubble{
  --bubble-bg:rgba(26,33,45,.92);
  --bubble-border:rgba(39,51,69,.7);
  --bubble-shadow:0 32px 46px rgba(0,0,0,.45);
}
body[data-theme="dark"].chat-page .bubble.assistant{
  --bubble-bg:linear-gradient(170deg, rgba(35,44,59,.94), rgba(30,37,48,.9));
  --bubble-border:rgba(226,0,26,.35);
  --bubble-shadow:0 30px 48px rgba(226,0,26,.26);
}
body[data-theme="dark"].chat-page .bubble.user{
  --bubble-bg:linear-gradient(170deg, rgba(30,42,66,.9), rgba(30,45,78,.86));
  --bubble-border:rgba(96,165,250,.3);
  --bubble-shadow:0 30px 48px rgba(59,130,246,.28);
}
.forklift-loader{
  display:flex;
  align-items:center;
  gap:12px;
  width:100%;
  font-size:12px;
  color:var(--muted);
}
.forklift-scene{
  position:relative;
  width:96px;
  height:44px;
}
.forklift-track{
  position:absolute;
  left:0;
  right:0;
  bottom:4px;
  height:6px;
  border-radius:999px;
  background:linear-gradient(180deg,#d1d5db,#cbd0d6);
  opacity:.7;
}
.forklift-move{
  position:absolute;
  left:4px;
  bottom:8px;
  width:88px;
  height:36px;
  animation:forklift-drive 2.6s ease-in-out infinite alternate;
}
.forklift-body{
  position:absolute;
  bottom:6px;
  left:12px;
  width:36px;
  height:22px;
  background:var(--motrac-red);
  border-radius:8px 8px 4px 4px;
  box-shadow:inset 0 -4px 0 rgba(0,0,0,.18);
}
.forklift-cabin{
  position:absolute;
  top:-12px;
  left:6px;
  width:18px;
  height:12px;
  border-radius:4px 4px 0 0;
  background:#fff;
  box-shadow:0 2px 0 rgba(0,0,0,.1);
}
.forklift-wheel{
  position:absolute;
  bottom:-8px;
  width:14px;
  height:14px;
  border-radius:50%;
  background:#111;
  box-shadow:inset 0 0 0 3px #2f2f2f,inset 0 0 0 6px #555;
  animation:forklift-wheel 1s linear infinite;
}
.forklift-wheel::before{
  content:'';
  position:absolute;
  inset:3px;
  border-radius:inherit;
  border:2px solid rgba(255,255,255,.35);
}
.forklift-wheel.front{left:-8px}
.forklift-wheel.back{right:-8px}
.forklift-mast{
  position:absolute;
  top:-6px;
  right:-10px;
  width:6px;
  height:28px;
  border-radius:3px;
  background:#2f3134;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
}
.forklift-fork{
  position:absolute;
  bottom:-8px;
  left:-18px;
  width:32px;
  height:5px;
  border-radius:4px;
  background:#45474b;
  box-shadow:0 -3px 0 rgba(255,255,255,.08);
}
.forklift-box{
  position:absolute;
  bottom:18px;
  left:60px;
  width:22px;
  height:22px;
  border-radius:4px;
  background:#fcd34d;
  box-shadow:inset 0 -5px 0 rgba(0,0,0,.18);
}
.forklift-box::after{
  content:'';
  position:absolute;
  inset:6px 5px 8px;
  border-radius:2px;
  background:rgba(0,0,0,.12);
}
.loader-text{flex:1;line-height:1.4}
@keyframes forklift-drive{
  from{transform:translateX(0)}
  to{transform:translateX(26px)}
}
@keyframes forklift-wheel{
  from{transform:rotate(0)}
  to{transform:rotate(360deg)}
}
@media (prefers-reduced-motion: reduce){
  .forklift-move,
  .forklift-wheel{
    animation:none;
  }
}
.bubble .role{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-size:11px;
  letter-spacing:.14em;
  text-transform:uppercase;
  color:var(--muted);
  margin-bottom:10px;
  padding:5px 12px;
  border-radius:999px;
  background:rgba(148,163,184,.16);
  font-weight:650;
}
.bubble.assistant .role{color:var(--motrac-red-700);background:rgba(226,0,26,.12)}
.bubble.user .role{color:#1d4ed8;background:rgba(59,130,246,.18)}
body[data-theme="dark"].chat-page .bubble .role{background:rgba(148,163,184,.16);color:var(--muted)}
body[data-theme="dark"].chat-page .bubble.assistant .role{color:#fca5a5;background:rgba(226,0,26,.22)}
body[data-theme="dark"].chat-page .bubble.user .role{color:#93c5fd;background:rgba(59,130,246,.25)}
.bubble .content{
  white-space:pre-wrap;
  line-height:1.6;
  font-size:15px;
  color:var(--ink-2);
}
body[data-theme="dark"].chat-page .bubble .content{color:var(--ink-2)}

.composer{
  position:relative;
  z-index:1;
  padding:18px 22px 22px;
  border-top:1px solid rgba(12,18,28,.08);
  background:linear-gradient(180deg, rgba(255,255,255,.86), rgba(255,255,255,.97));
  display:flex;
  gap:14px;
  align-items:flex-end;
}
body[data-theme="dark"].chat-page .composer{
  border-top:1px solid rgba(17,22,33,.65);
  background:linear-gradient(180deg, rgba(22,27,36,.92), rgba(15,19,27,.96));
}
.composer textarea{
  flex:1;
  resize:vertical;
  max-height:220px;
  min-height:56px;
  padding:14px 16px;
  border:1px solid rgba(12,18,28,.12);
  border-radius:16px;
  font:inherit;
  line-height:1.5;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.4);
  background:rgba(255,255,255,.82);
  color:inherit;
  transition:border-color .2s ease, box-shadow .2s ease, background-color .2s ease;
}
body[data-theme="dark"].chat-page .composer textarea{
  border-color:rgba(31,41,55,.6);
  background:rgba(25,30,41,.88);
  box-shadow:none;
}
.composer textarea::placeholder{color:rgba(107,114,128,.8)}
body[data-theme="dark"].chat-page .composer textarea::placeholder{color:rgba(148,163,184,.7)}
.composer textarea:focus{
  outline:none;
  border-color:rgba(226,0,26,.55);
  box-shadow:0 0 0 3px var(--ring);
  background:rgba(255,255,255,.94);
}
body[data-theme="dark"].chat-page .composer textarea:focus{
  background:rgba(30,37,49,.95);
}
.btn{
  position:relative;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  padding:12px 18px;
  border-radius:18px;
  border:1px solid rgba(12,18,28,.12);
  background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(244,244,248,.92));
  box-shadow:0 12px 28px rgba(15,17,22,.08), inset 0 1px 0 rgba(255,255,255,.65);
  color:var(--ink-2);
  font-weight:650;
  font-size:14px;
  letter-spacing:.01em;
  cursor:pointer;
  text-decoration:none;
  transition:transform .18s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}
.btn:hover:not(:disabled){
  transform:translateY(-1px);
  box-shadow:0 16px 34px rgba(15,17,22,.12), inset 0 1px 0 rgba(255,255,255,.75);
}
.btn:active:not(:disabled){
  transform:translateY(0);
  background:linear-gradient(180deg, rgba(236,236,240,.98), rgba(228,228,234,.94));
  box-shadow:0 8px 18px rgba(15,17,22,.12), inset 0 1px 0 rgba(255,255,255,.55);
}
.btn:focus-visible{
  outline:3px solid rgba(226,0,26,.2);
  outline-offset:3px;
}
.btn:disabled{
  opacity:.55;
  cursor:not-allowed;
  box-shadow:none;
  transform:none;
}
.btn.primary{
  background:linear-gradient(135deg, #ff6d76, var(--motrac-red));
  border-color:rgba(226,0,26,.85);
  color:#fff;
  text-shadow:0 1px 2px rgba(0,0,0,.18);
  box-shadow:0 16px 32px rgba(226,0,26,.28), inset 0 1px 0 rgba(255,255,255,.38);
}
.btn.primary:hover:not(:disabled){
  box-shadow:0 20px 36px rgba(226,0,26,.32), inset 0 1px 0 rgba(255,255,255,.45);
}
.btn.primary:active:not(:disabled){
  background:linear-gradient(135deg, #ff4d61, var(--motrac-red-700));
  box-shadow:0 10px 24px rgba(226,0,26,.26), inset 0 1px 0 rgba(255,255,255,.32);
}
.btn.secondary{
  color:var(--ink);
  background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(240,242,248,.9));
  border-color:rgba(12,18,28,.14);
}
.btn.secondary:hover:not(:disabled){
  border-color:rgba(12,18,28,.2);
}
.btn.small{
  padding:10px 14px;
  font-size:13px;
  border-radius:14px;
}
.btn.icon{
  padding:0;
  width:48px;
  height:48px;
  justify-content:center;
  border-radius:16px;
}
.btn.icon svg{width:20px;height:20px}
body[data-theme="dark"] .btn{
  border-color:rgba(40,52,72,.65);
  background:linear-gradient(180deg, rgba(36,44,60,.95), rgba(26,32,46,.9));
  box-shadow:0 16px 32px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  color:var(--ink);
}
body[data-theme="dark"] .btn:hover:not(:disabled){
  box-shadow:0 22px 40px rgba(0,0,0,.52), inset 0 1px 0 rgba(255,255,255,.12);
}
body[data-theme="dark"] .btn:active:not(:disabled){
  background:linear-gradient(180deg, rgba(32,40,54,.95), rgba(24,30,44,.9));
  box-shadow:0 12px 26px rgba(0,0,0,.42), inset 0 1px 0 rgba(255,255,255,.08);
}
body[data-theme="dark"] .btn.primary{
  background:linear-gradient(135deg, #ff5c6f, #b90017);
  border-color:rgba(255,92,108,.65);
  box-shadow:0 20px 38px rgba(226,0,26,.38), inset 0 1px 0 rgba(255,255,255,.18);
  color:#fff;
}
body[data-theme="dark"] .btn.primary:hover:not(:disabled){
  box-shadow:0 24px 42px rgba(226,0,26,.42), inset 0 1px 0 rgba(255,255,255,.22);
}
body[data-theme="dark"] .btn.primary:active:not(:disabled){
  background:linear-gradient(135deg, #ff3f58, #8f0012);
  box-shadow:0 14px 28px rgba(226,0,26,.32), inset 0 1px 0 rgba(255,255,255,.16);
}
body[data-theme="dark"] .btn.secondary{color:var(--ink);}
body.chat-page .composer .btn{
  min-height:56px;
  padding:0 28px;
  border-radius:22px;
  font-size:15px;
  letter-spacing:.01em;
  box-shadow:0 18px 36px rgba(226,0,26,.28), inset 0 1px 0 rgba(255,255,255,.4);
}
body.chat-page .composer .btn.primary{
  box-shadow:0 22px 42px rgba(226,0,26,.34), inset 0 1px 0 rgba(255,255,255,.46);
}
body.chat-page .composer .btn.primary:hover:not(:disabled){
  box-shadow:0 26px 48px rgba(226,0,26,.4), inset 0 1px 0 rgba(255,255,255,.52);
}
body.chat-page .composer .btn:active:not(:disabled){
  transform:translateY(0);
  box-shadow:0 14px 28px rgba(226,0,26,.28), inset 0 1px 0 rgba(255,255,255,.32);
}
body[data-theme="dark"].chat-page .composer .btn{
  box-shadow:0 20px 40px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.12);
}
body[data-theme="dark"].chat-page .composer .btn.primary{
  box-shadow:0 24px 46px rgba(226,0,26,.42), inset 0 1px 0 rgba(255,255,255,.22);
}
body[data-theme="dark"].chat-page .composer .btn.primary:hover:not(:disabled){
  box-shadow:0 28px 52px rgba(226,0,26,.48), inset 0 1px 0 rgba(255,255,255,.26);
}
body.chat-page .chat-toolbar .btn.secondary.icon{
  background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(242,244,248,.85));
  border-color:rgba(12,18,28,.16);
  box-shadow:0 16px 30px rgba(15,17,22,.12), inset 0 1px 0 rgba(255,255,255,.6);
}
body.chat-page .chat-toolbar .btn.secondary.icon:hover:not(:disabled){
  box-shadow:0 20px 34px rgba(15,17,22,.16), inset 0 1px 0 rgba(255,255,255,.68);
}
body[data-theme="dark"].chat-page .chat-toolbar .btn.secondary.icon{
  background:linear-gradient(180deg, rgba(34,42,58,.9), rgba(26,32,44,.86));
  border-color:rgba(40,52,72,.7);
  box-shadow:0 20px 36px rgba(0,0,0,.52), inset 0 1px 0 rgba(255,255,255,.12);
}
.sr-only{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  white-space:nowrap;
  border:0;
}

.row{display:flex;gap:8px;align-items:center}
.grow{flex:1}
.sep{height:1px;background:var(--border-subtle);margin:10px 0}

.badge{
  font-size:11px;
  padding:3px 8px;
  border-radius:999px;
  border:1px solid var(--border-strong);
  background:var(--card);
  white-space:nowrap;
}
body.chat-page .badge{
  background:rgba(255,255,255,.78);
  border-color:rgba(12,18,28,.14);
  box-shadow:0 14px 28px rgba(15,17,22,.08);
}
body[data-theme="dark"].chat-page .badge{
  background:rgba(23,30,42,.82);
  border-color:rgba(36,48,66,.72);
  box-shadow:0 16px 32px rgba(0,0,0,.5);
}
.status.ok{color:var(--ok)}
.status.warn{color:var(--warn)}
.status.err{color:var(--err)}

.input{
  font:inherit;
  border:1px solid var(--border-strong);
  border-radius:10px;
  padding:6px 8px;
  background:var(--card);
  color:inherit;
  min-width:0;
}
.input:focus{
  outline:none;
  border-color:var(--motrac-red);
  box-shadow:0 0 0 3px var(--ring);
}

.tiny{font-size:11px;color:var(--muted)}
.right{
  margin-left:auto;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:10px;
  flex-wrap:wrap;
}

.modal{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
  background:rgba(11,13,15,.45);
  z-index:50;
}
.modal[aria-hidden="true"]{display:none}
.modal-card{max-width:420px;width:100%;position:relative}
.modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.settings-body{display:flex;flex-direction:column;gap:10px}
.settings-section{display:flex;flex-direction:column;gap:10px}
.settings-section h4{margin:0;font-size:13px;font-weight:700;letter-spacing:.04em;text-transform:uppercase;color:var(--ink)}
.settings-list{margin:6px 0 0 16px;padding:0 0 0 4px;display:flex;flex-direction:column;gap:4px}

.theme-toggle{
  position:fixed;
  right:24px;
  bottom:24px;
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:12px 16px;
  border-radius:999px;
  border:1px solid var(--border-strong);
  background:var(--card);
  color:var(--ink);
  font-weight:650;
  font-size:14px;
  cursor:pointer;
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  transition:transform .2s ease, box-shadow .2s ease, background-color .3s ease, color .3s ease;
  z-index:20;
}
.theme-toggle:hover{transform:translateY(-2px);box-shadow:0 22px 46px rgba(0,0,0,.22);}
.theme-toggle:focus-visible{outline:none;box-shadow:0 0 0 4px var(--ring);}

body[data-theme="dark"] .card,
body[data-theme="dark"] .tag,
body[data-theme="dark"] .doc,
body[data-theme="dark"] .bubble,
body[data-theme="dark"] .badge,
body[data-theme="dark"] .input,
body[data-theme="dark"] .composer textarea,
body[data-theme="dark"] .upload,
body[data-theme="dark"] .theme-toggle{
  background:var(--surface-soft);
}
body[data-theme="dark"] .card{box-shadow:var(--shadow);}
body[data-theme="dark"] .tag:hover{background:#232b38;}
body[data-theme="dark"] .bubble.assistant{border-color:#ff9aa4;background:linear-gradient(180deg,#1d2532,#19202b);}
body[data-theme="dark"] .theme-toggle{box-shadow:0 26px 56px rgba(0,0,0,.38);}
body[data-theme="dark"] .theme-toggle:hover{box-shadow:0 32px 64px rgba(0,0,0,.45);}

body.background-match .theme-toggle{
  background:rgba(25,28,40,.8);
  border-color:var(--border-strong);
  color:var(--ink);
  box-shadow:0 22px 52px rgba(3,4,10,.6);
}

body.background-match .theme-toggle:hover{
  box-shadow:0 28px 60px rgba(3,4,10,.65);
}

body.background-match .theme-toggle:focus-visible{
  box-shadow:0 0 0 4px rgba(0,231,255,.25);
}

@media (max-width: 600px){
  .theme-toggle{right:16px;bottom:16px;padding:11px 14px;font-size:13px}
}

@media (max-width: 900px){
  .title{font-size:17px}
}

@media (max-width: 720px){
  .bar{padding:12px 16px}
  .right{
    margin-left:0;
    width:100%;
    justify-content:flex-start;
    gap:8px;
  }
  .headings{flex:1}
  .title{font-size:16px}
  .sub{font-size:12px}
}

@media (max-width: 600px){
  .wrap{margin:12px auto;padding:0 12px}
  .bar{gap:10px}
  .logo{width:40px;height:40px;padding:5px}
  .chat{height:auto;min-height:65vh}
  .messages{padding:12px}
  .composer{flex-direction:column;align-items:stretch}
  .composer textarea{min-height:110px;width:100%;flex:auto}
  .composer .btn{width:100%;justify-content:center}
  .side{order:2}
  .prechat-top{padding:18px 16px 8px}
  .prechat-title{font-size:22px}
  .prechat-sub{font-size:13px}
  .prechat-container{padding:0 16px 18px}
  .prechat-actions{grid-template-columns:1fr;gap:8px}
  .prechat-actions .btn{min-height:52px}
  .prechat-card{gap:16px}
  .prechat-footer{padding:16px 14px 22px}
}

@media (max-width: 480px){
  .badge{font-size:10px;padding:3px 6px}
  .btn.small{padding:8px 12px;font-size:12px;border-radius:12px}
  .title{font-size:15px}
  .sub{font-size:11px}
  .wrap{padding:0 10px}
  .prechat-title{font-size:20px}
  .prechat-sub{font-size:12px}
  .prechat-branding{gap:4px}
}
